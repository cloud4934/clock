<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flip Clock — Single Midline Fold</title>
  <style>
    :root{
      --bg:#111827;--card:#0b0f19;--card-inner:#0e1422;--digit:#e5e7eb;--divider:rgba(255,255,255,.12);--shadow:rgba(0,0,0,.5)
    }
    html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr}
    .controls{display:flex;gap:.75rem;flex-wrap:wrap;align-items:center;padding:10px 14px;background:rgba(0,0,0,.25);position:sticky;top:0;backdrop-filter:blur(6px);z-index:10}
    .controls label{font-size:14px;color:#cbd5e1}
    select,input[type="checkbox"],button{font-size:14px;padding:6px 8px;background:#0b0f19;color:#e5e7eb;border:1px solid #1f2937;border-radius:8px}
    button{cursor:pointer}
    .screen{display:grid;place-items:center;height:100%;padding:16px}
    .clock{display:flex;gap:clamp(8px,2vw,16px);align-items:center}

    /* Card */
    .flip{position:relative;width:clamp(90px,12vw,180px);height:clamp(120px,16vw,240px);perspective:1600px;perspective-origin:center 50%}
    .card{position:relative;width:100%;height:100%;border-radius:16px;background:linear-gradient(180deg,var(--card),var(--card-inner));box-shadow:0 12px 28px var(--shadow)}

    /* Halves fill whole card then get clipped */
    .half{position:absolute;inset:0;display:grid;place-items:center;backface-visibility:hidden;-webkit-backface-visibility:hidden;transform-style:preserve-3d}
    .half.top{clip-path:inset(0 0 50% 0)}
    .half.bottom{clip-path:inset(50% 0 0 0)}

    /* Pivot modes */
    .pivot-midline .half.top{transform-origin:center bottom}
    .pivot-center  .half.top{transform-origin:center center}

    .half.top.back{transform:rotateX(180deg)}

    .glyph{font-weight:800;font-variant-numeric:tabular-nums;font-size:clamp(64px,10vw,140px);line-height:1;color:var(--digit)}

    .midline{position:absolute;left:0;right:0;top:50%;height:1px;background:var(--divider)}
    .ampm{position:absolute;bottom:8px;left:10px;font-size:12px;color:#9aa3af;letter-spacing:.08em}

    /* Colon + date */
    .colon{width:clamp(22px,3vw,36px);height:clamp(100px,14vw,210px);display:grid;grid-template-rows:1fr 1fr;gap:12px;align-items:center;justify-items:center;opacity:.9}
    .dot{width:12px;height:12px;border-radius:50%;background:var(--digit)}
    .date{margin-top:clamp(10px,2vw,18px);text-align:center;font-size:clamp(14px,2vw,22px);color:#cbd5e1}

    /* Single-phase animation: only top half flips over the midline */
    @keyframes topFold{from{transform:rotateX(0) translateZ(0.01px)}to{transform:rotateX(-180deg) translateZ(0.01px)}}
    @keyframes topReveal{from{transform:rotateX(180deg) translateZ(0.01px)}to{transform:rotateX(0) translateZ(0.01px)}}

    .flip-top .half.top.front{animation:topFold .36s cubic-bezier(.37,.01,.64,1) forwards; z-index:3; will-change:transform}
    .flip-top .half.top.back {animation:topReveal .36s cubic-bezier(.37,.01,.64,1) forwards; z-index:2; will-change:transform}
  </style>
</head>
<body class="pivot-midline">
  <div class="wrap">
    <div class="controls">
      <label><input id="modeToggle" type="checkbox"/> 24‑jam</label>
      <label> Zon GMT:
        <select id="tzPicker"></select>
      </label>
      <label> Tema latar:
        <select id="bgPicker">
          <option value="#111827">Gelap (Default)</option>
          <option value="#000000">Hitam</option>
          <option value="#1f2937">Kelabu</option>
          <option value="#0ea5e9">Biru</option>
          <option value="#10b981">Hijau</option>
          <option value="#ef4444">Merah</option>
          <option value="#a855f7">Ungu</option>
          <option value="#ffffff">Putih</option>
        </select>
      </label>
      <label> Pivot:
        <select id="pivotPicker">
          <option value="pivot-midline" selected>Midline (Classic)</option>
          <option value="pivot-center">Center (Experimental)</option>
        </select>
      </label>
      <button id="fsBtn">Full Screen</button>
    </div>

    <div class="screen">
      <div>
        <div class="clock">
          <div class="flip" id="h1"></div>
          <div class="flip" id="h2"></div>
          <div class="colon"><div class="dot"></div><div class="dot"></div></div>
          <div class="flip" id="m1"></div>
          <div class="flip" id="m2"></div>
          <div class="colon"><div class="dot"></div><div class="dot"></div></div>
          <div class="flip" id="s1"></div>
          <div class="flip" id="s2"></div>
        </div>
        <div class="date" id="date"></div>
      </div>
    </div>
  </div>

  <script>
    const pad2 = n => (n<10?"0"+n:n);
    let currentTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;

    function makeDigit(el, value, badge=''){
      el.innerHTML = `
        <div class="card">
          <div class="half top front"><div class="glyph">${value}</div></div>
          <div class="half top back"><div class="glyph">${value}</div></div>
          <div class="half bottom front"><div class="glyph">${value}</div></div>
          <div class="midline"></div>
          ${badge?`<div class="ampm">${badge}</div>`:''}
        </div>`;
    }

    function flipTo(el, nextVal, badgeText=''){
      const tFront = el.querySelector('.half.top.front .glyph');
      const bFront = el.querySelector('.half.bottom.front .glyph');
      const tBack  = el.querySelector('.half.top.back .glyph');
      if (tFront.textContent === nextVal) return;

      tBack.textContent = nextVal; // next value only on top back
      const badge = el.querySelector('.ampm');
      if (badge || badgeText){ if (badge) badge.textContent = badgeText; }

      // Start single-phase flip on top
      el.classList.remove('flip-top'); void el.offsetWidth; el.classList.add('flip-top');

      const DUR = 360; // ms, must match CSS .36s
      // At halfway point, swap the bottom to NEXT so after fold the digit is complete
      setTimeout(()=>{ bFront.textContent = nextVal; }, Math.round(DUR/2));

      function onDone(e){
        if (e.animationName !== 'topFold') return;
        el.removeEventListener('animationend', onDone);
        // Sync top front to NEXT as well (for next cycle)
        tFront.textContent = nextVal;
        el.classList.remove('flip-top');
      }
      el.addEventListener('animationend', onDone);
    }

    function setupDigit(id, initial, badge=''){
      const el = document.getElementById(id);
      makeDigit(el, initial, badge);
      return (v,b=badge)=>flipTo(el,v,b);
    }

    function parts(now){
      const fmt = new Intl.DateTimeFormat('en-GB',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false,timeZone:currentTZ}).formatToParts(now);
      return {
        h: parseInt(fmt.find(p=>p.type==='hour').value,10),
        m: fmt.find(p=>p.type==='minute').value,
        s: fmt.find(p=>p.type==='second').value,
      };
    }

    const upd = {};
    function init(){
      const now = new Date();
      const is24 = document.getElementById('modeToggle').checked;
      const {h,m,s} = parts(now);
      const hour = is24 ? h : ((h+11)%12)+1;
      const ampm = h<12? 'AM' : 'PM';
      const [h1,h2] = pad2(hour).split('');
      const [m1,m2] = m.split('');
      const [s1,s2] = s.split('');
      upd.h1 = setupDigit('h1', h1, is24?'':ampm);
      upd.h2 = setupDigit('h2', h2);
      upd.m1 = setupDigit('m1', m1);
      upd.m2 = setupDigit('m2', m2);
      upd.s1 = setupDigit('s1', s1);
      upd.s2 = setupDigit('s2', s2);
      updateDate(now);
    }

    function tick(){
      const now = new Date();
      const is24 = document.getElementById('modeToggle').checked;
      const {h,m,s} = parts(now);
      const hour = is24 ? h : ((h+11)%12)+1;
      const ampm = h<12? 'AM' : 'PM';
      const [H1,H2] = pad2(hour).split('');
      const [M1,M2] = m.split('');
      const [S1,S2] = s.split('');
      upd.h1(H1, is24?'':ampm); upd.h2(H2);
      upd.m1(M1); upd.m2(M2);
      upd.s1(S1); upd.s2(S2);
      if (s==='00') updateDate(now);
    }

    function updateDate(d){
      const opts={weekday:'short',year:'numeric',month:'short',day:'2-digit',timeZone:currentTZ};
      document.getElementById('date').textContent = d.toLocaleDateString(undefined, opts);
    }

    // Controls
    document.getElementById('modeToggle').addEventListener('change', init);
    document.getElementById('bgPicker').addEventListener('change', e=>{document.documentElement.style.setProperty('--bg', e.target.value)});
    document.getElementById('fsBtn').addEventListener('click',()=>{if(!document.fullscreenElement)document.documentElement.requestFullscreen();else document.exitFullscreen();});

    // Pivot picker
    const pivotPicker=document.getElementById('pivotPicker');
    pivotPicker.addEventListener('change', e=>{
      document.body.classList.remove('pivot-midline','pivot-center');
      document.body.classList.add(e.target.value);
    });

    // TZ picker
    const tzPicker=document.getElementById('tzPicker');
    const tzList = (Intl.supportedValuesOf && Intl.supportedValuesOf('timeZone')) || [
      'UTC','Asia/Kuala_Lumpur','Asia/Singapore','Asia/Tokyo','Europe/London','America/New_York','America/Los_Angeles','Australia/Sydney'
    ];
    tzList.forEach(tz=>{const o=document.createElement('option');o.value=tz;o.textContent=tz;if(tz===currentTZ)o.selected=true;tzPicker.appendChild(o)});
    tzPicker.addEventListener('change',e=>{currentTZ=e.target.value;init()});

    init();
    setInterval(tick,1000);
  </script>
</body>
</html>
